ðŸ› ï¸ Sample Data
sql
-- 5 users
INSERT INTO Users (name, email, phone, date_of_birth, gender) VALUES
('Alice Johnson', 'alice.johnson@example.com', '1234567890', '1990-05-15', 'Female'),
('Bob Smith', 'bob.smith@example.com', '2345678901', '1985-08-20', 'Male'),
('Carol Davis', 'carol.davis@example.com', '3456789012', '1992-11-03', 'Female'),
('Dave Wilson', 'dave.wilson@example.com', '4567890123', '1988-07-12', 'Male'),
('Eva Brown', 'eva.brown@example.com', '5678901234', '1995-02-28', 'Female');

-- 20 categories (flat + hierarchical)
INSERT INTO Categories (category_name, parent_category_id) VALUES
('Electronics', NULL),
('Smartphones', 1),
('Laptops', 1),
('Home Appliances', NULL),
('Kitchen Appliances', 4),
('Books', NULL),
('Fiction', 6),
('Non-Fiction', 6),
('Clothing', NULL),
('Men', 9),
('Women', 9),
('Sports', NULL),
('Outdoor', 12),
('Fitness', 12),
('Toys', NULL),
('Educational', 15),
('Games', 15),
('Beauty', NULL),
('Skincare', 18),
('Makeup', 18);

-- 14 products across categories
INSERT INTO Products (name, description, price, stock_quantity, category_id) VALUES
('iPhone 14', 'Latest Apple smartphone', 999.99, 50, 2),
('Samsung Galaxy S23', 'Android flagship phone', 899.99, 60, 2),
('Dell XPS 13', 'High-end laptop', 1199.99, 40, 3),
('HP Spectre x360', 'Convertible laptop', 1299.99, 30, 3),
('Blender', 'Kitchen appliance for smoothies', 49.99, 100, 5),
('Microwave Oven', 'Compact microwave', 89.99, 70, 5),
('The Great Gatsby', 'Classic fiction novel', 14.99, 200, 7),
('Atomic Habits', 'Self-help book', 21.99, 150, 8),
('Men\'s T-Shirt', 'Cotton casual t-shirt', 19.99, 120, 10),
('Women\'s Jacket', 'Winter jacket', 59.99, 80, 11),
('Football', 'Professional size football', 29.99, 90, 12),
('Yoga Mat', 'Eco-friendly yoga mat', 24.99, 110, 14),
('Lego Building Blocks', 'Educational toy', 39.99, 75, 16),
('Lipstick', 'Long-lasting makeup', 15.99, 100, 20);

-- 5 orders, 7 order items, 4 payments, 5 reviews
-- (see full script for INSERTs into Orders, Order_Items, Payments, Reviews, Shipping)
ðŸ” Core Analytics Queries
1. Recent Users (Last 30 Days)
sql
SELECT *
FROM Users
WHERE created_at >= CURDATE() - INTERVAL 30 DAY;
2. Highâ€‘Value Inâ€‘Stock Products
sql
SELECT *
FROM Products
WHERE price > 1000
  AND stock_quantity > 0;
3. Top Orders by Amount
sql
SELECT *
FROM Orders
ORDER BY total_amount DESC;
4. Total Sales per Category
sql
SELECT c.category_name,
       SUM(oi.quantity * oi.price_at_purchase) AS total_sales
FROM Order_Items oi
JOIN Products p ON oi.product_id = p.product_id
JOIN Categories c ON p.category_id = c.category_id
GROUP BY c.category_name;
5. Average Rating per Product
sql
SELECT p.product_id, p.name,
       AVG(r.rating) AS average_rating
FROM Reviews r
JOIN Products p ON r.product_id = p.product_id
GROUP BY p.product_id, p.name;
6. Orders per User (Last Month)
sql
SELECT u.user_id, u.name, COUNT(o.order_id) AS orders_last_month
FROM Users u
JOIN Orders o ON u.user_id = o.user_id
WHERE o.order_date >= CURDATE() - INTERVAL 30 DAY
GROUP BY u.user_id, u.name
HAVING COUNT(o.order_id) > 5;
ðŸ”— Join Patterns
User Orders (INNER JOIN)
sql
SELECT u.user_id, u.name, o.order_id, o.order_date, o.total_amount
FROM Users u
INNER JOIN Orders o ON u.user_id = o.user_id;
Products Without Reviews (LEFT JOIN)
sql
SELECT p.product_id, p.name, r.review_id
FROM Products p
LEFT JOIN Reviews r ON p.product_id = r.product_id
WHERE r.review_id IS NULL;
Category Hierarchy (SELF JOIN)
sql
SELECT child.category_id AS child_id, child.category_name AS child_name,
       parent.category_id AS parent_id, parent.category_name AS parent_name
FROM Categories child
LEFT JOIN Categories parent ON child.parent_category_id = parent.category_id;
ðŸ“Š Advanced Queries
Products Priced Above Category Average
sql
SELECT product_id, name, price, category_id
FROM Products p1
WHERE price > (
    SELECT AVG(price)
    FROM Products p2
    WHERE p2.category_id = p1.category_id
);
Monthly Sales CTE
sql
WITH monthly_sales AS (
  SELECT DATE_FORMAT(o.order_date, '%Y-%m') AS month,
         SUM(oi.quantity * oi.price_at_purchase) AS total_sales
  FROM Orders o
  JOIN Order_Items oi ON o.order_id = oi.order_id
  GROUP BY month
)
SELECT month, total_sales
FROM monthly_sales
ORDER BY month DESC;
Topâ€‘Selling Products View
sql
CREATE VIEW top_selling_products AS
SELECT p.product_id, p.name,
       SUM(oi.quantity) AS total_quantity_sold
FROM Products p
JOIN Order_Items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name
ORDER BY total_quantity_sold DESC;
ðŸ§¹ Data Cleaning & Functions
Clean User Emails
sql
SELECT user_id, TRIM(LOWER(email)) AS cleaned_email
FROM Users;
Late Shipping (More Than 7 Days)
sql
SELECT s.order_id, o.order_date, s.shipped_date,
       DATEDIFF(s.shipped_date, o.order_date) AS days_to_ship
FROM Shipping s
JOIN Orders o ON s.order_id = o.order_id
WHERE s.shipped_date IS NOT NULL
  AND DATEDIFF(s.shipped_date, o.order_date) > 7;
Apply Discount (15% Off)
sql
SELECT product_id, name, price,
       ROUND(price * 0.85, 2) AS discounted_price
FROM Products;
âš™ï¸ Performance & Indexing
Indexes for Large Datasets
sql
-- For JOINs and filtering
CREATE INDEX idx_orders_user_id ON Orders(user_id);
CREATE INDEX idx_order_items_product_id ON Order_Items(product_id);

-- For date-based queries
CREATE INDEX idx_orders_order_date ON Orders(order_date);
CREATE INDEX idx_payments_payment_date ON Payments(payment_date);
Partitioning (for 50Kâ€“100K+ Rows)
sql
-- Example: Partition Orders by year
CREATE TABLE Orders (
  order_id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT,
  order_date DATE NOT NULL,
  status VARCHAR(50),
  total_amount DECIMAL(10,2) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES Users(user_id)
)
PARTITION BY RANGE (YEAR(order_date)) (
  PARTITION p2024 VALUES LESS THAN (2025),
  PARTITION p2025 VALUES LESS THAN (2026),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
Test with EXPLAIN
sql
EXPLAIN
SELECT u.name, o.order_date, SUM(oi.quantity * oi.price_at_purchase) AS order_value
FROM Users u
JOIN Orders o ON u.user_id = o.user_id
JOIN Order_Items oi ON o.order_id = oi.order_id
WHERE o.order_date >= '2025-11-01'
GROUP BY u.user_id, u.name, o.order_date;
ðŸ“¦ Intermediate Results (Temp Tables)
sql
-- Daily revenue for BI dashboards
CREATE TEMPORARY TABLE daily_revenue AS
SELECT order_date,
       SUM(oi.quantity * oi.price_at_purchase) AS total_revenue
FROM Orders o
JOIN Order_Items oi ON o.order_id = oi.order_id
GROUP BY order_date;

-- Use in reports
SELECT * FROM daily_revenue WHERE order_date = CURDATE();
ðŸ’³ Transaction: Place an Order
sql
START TRANSACTION;

-- 1. Check stock (for product_id = 1, quantity = 2)
SELECT stock_quantity FROM Products WHERE product_id = 1 FOR UPDATE;

-- 2. Reduce stock (only if stock >= 2)
UPDATE Products SET stock_quantity = stock_quantity - 2 WHERE product_id = 1;

-- 3. Create order
INSERT INTO Orders (user_id, order_date, status, total_amount)
VALUES (1, CURDATE(), 'Processing', 199.98);

SET @new_order_id = LAST_INSERT_ID();

-- 4. Insert order items
INSERT INTO Order_Items (order_id, product_id, quantity, price_at_purchase)
VALUES (@new_order_id, 1, 2, 99.99);

-- 5. Process payment
INSERT INTO Payments (order_id, payment_date, amount, payment_method, status)
VALUES (@new_order_id, CURDATE(), 199.98, 'Credit Card', 'Paid');

COMMIT;
